USE TestPracticGrila
GO

CREATE TABLE T(
TID INT PRIMARY KEY,
C1 INT,
C2 INT,
C3 INT,
C4 INT,
C5 INT,
C6 INT
)
INSERT T VALUES(10,60,60,6,4,20,7)
INSERT T VALUES(11,70,70,7,4,100,9)
INSERT T VALUES(12,80,80,8,4,30,9)
INSERT T VALUES(13,90,90,9,3,90,9)
INSERT T VALUES(14,90,100,10,3,40,9)
INSERT T VALUES(15,90,110,11,9,5,9)
INSERT T VALUES(16,10,10,1,0,100,5)
INSERT T VALUES(17,20,20,2,2,50,5)
INSERT T VALUES(18,30,30,3,5,60,5)
INSERT T VALUES(19,40,40,4,4,50,7)
INSERT T VALUES(20,50,50,5,7,50,7)

SELECT t3.TID,COUNT(*)NumRows
FROM T t1 INNER JOIN T t2 ON t1.TID=t2.TID
INNER JOIN T t3
ON t2.TID=t3.TID
WHERE t1.C2<=50
GROUP BY t3.TID
HAVING COUNT(*)>=1


SELECT t1.C2,t1.C4
FROM T t1
WHERE t1.TID<=15
EXCEPT
SELECT t2.C1,t2.C3
FROM T t2
WHERE t2.TID>=1

CREATE OR ALTER FUNCTION ufF1(@C4 INT)
RETURNS INT
BEGIN
RETURN
(SELECT COUNT(*)
FROM T
WHERE C4 BETWEEN 4 AND @C4)
END

CREATE OR ALTER TRIGGER  TrOnInsert
ON T
FOR INSERT
AS
INSERT InsertLog(C4Value,N,DateTimeOp)
SELECT C4,dbo.ufF1(C4),GETDATE()
FROM inserted

CREATE TABLE InsertLog(
Id int IDENTITY(1,1) PRIMARY KEY,
C4Value INT,
N INT,
DateTimeOp Date
)

INSERT T(TID,C4)VALUES(22,9)
INSERT T(TID,C4)VALUES(26,8),(27,8)
INSERT T(TID,C4)VALUES(28,8)